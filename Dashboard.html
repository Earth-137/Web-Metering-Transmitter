<!DOCTYPE html>
<html>
<head> 
  <base target="_top">
  <style>
    Â  Â  Â  Â  /* ==================== GAYA UMUM ==================== */
    Â  Â  Â  Â  body {
    Â  Â  Â  Â  Â  Â  background-color: #03045E;
    Â  Â  Â  Â  Â  Â  font-family: Arial, sans-serif;
    Â  Â  Â  Â  Â  Â  text-align: center;
    Â  Â  Â  Â  Â  Â  padding: 50px;
    Â  Â  Â  Â  Â  Â  color: #B8FB3C; /* Warna teks utama menjadi hijau neon */
    Â  Â  Â  Â  }
    Â  Â  Â  Â  h1 {
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    Â  Â  Â  Â  }
    Â  Â  Â  Â  p {
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    Â  Â  Â  Â  }
    Â  Â  Â  Â  .back-button {
    Â  Â  Â  Â  Â  Â  position: absolute;
    Â  Â  Â  Â  Â  Â  top: 10px;
    Â  Â  Â  Â  Â  Â  left: 10px;
    Â  Â  Â  Â  Â  Â  /* Styling untuk tombol kembali agar selaras dengan tema */
    Â  Â  Â  Â  Â  Â  background-color: #03045E;
    Â  Â  Â  Â  Â  Â  border: 2px solid #B8FB3C;
    Â  Â  Â  Â  Â  Â  border-radius: 5px;
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    Â  Â  Â  Â  Â  Â  padding: 8px 15px;
    Â  Â  Â  Â  Â  Â  font-size: 14px;
    Â  Â  Â  Â  Â  Â  cursor: pointer;
    Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
    Â  Â  Â  Â  }
    Â  Â  Â  Â  .back-button:hover {
    Â  Â  Â  Â  Â  Â  background-color: #B8FB3C;
    Â  Â  Â  Â  Â  Â  color: #03045E;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  /* ==================== GAYA TOMBOL DAN DROPDOWN KUSTOM ===================== */
    Â  Â  Â  Â  .shape-tombol-aksi {
    Â  Â  Â  Â  Â  Â  background-color: #03045E;
    Â  Â  Â  Â  Â  Â  border: 2px solid #B8FB3C;
    Â  Â  Â  Â  Â  Â  border-radius: 5px;
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    Â  Â  Â  Â  Â  Â  padding: 10px 20px;
    Â  Â  Â  Â  Â  Â  font-size: 16px;
    Â  Â  Â  Â  Â  Â  cursor: pointer;
    Â  Â  Â  Â  Â  Â  display: inline-block;
    Â  Â  Â  Â  Â  Â  text-decoration: none;
    Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
    Â  Â  Â  Â  Â  Â  margin: 5px; /* Tambahkan sedikit margin */
    Â  Â  Â  Â  }

    Â  Â  Â  Â  .shape-tombol-aksi:hover, .shape-tombol-aksi.selected {
    Â  Â  Â  Â  Â  Â  background-color: #B8FB3C;
    Â  Â  Â  Â  Â  Â  color: #03045E;
    Â  Â  Â  Â  Â  Â  box-shadow: 0 0 10px #B8FB3C;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  .dropdown {
    Â  Â  Â  Â  Â  Â  position: relative;
    Â  Â  Â  Â  Â  Â  display: inline-block;
    Â  Â  Â  Â  Â  Â  margin-right: 10px;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  .dropdown-content {
    Â  Â  Â  Â  Â  Â  display: none;
    Â  Â  Â  Â  Â  Â  position: absolute;
    Â  Â  Â  Â  Â  Â  background-color: #05143a; /* Warna latar belakang gelap */
    D Â  Â  Â  Â  Â  min-width: 200px;
    Â  Â  Â  Â  Â  Â  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5);
    Â  Â  Â  Â  Â  Â  z-index: 10;
    Â  Â  Â  Â  Â  Â  border: 1px solid #B8FB3C; /* Border hijau neon */
    Â  Â  Â  Â  Â  Â  max-height: 300px;
    Â  Â  Â  Â  Â  Â  overflow-y: auto;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  .dropdown-content a {
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    Â  Â  Â  Â  Â  Â  padding: 12px 16px;
    Â  Â  Â  Â  Â  Â  text-decoration: none;
    Â  Â  Â  Â  Â  Â  display: block;
    Â  Â  Â  Â  Â  Â  white-space: nowrap;
    Â  Â  Â  Â  Â  Â  text-align: left;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  .dropdown-content a:hover {
    Â  Â  Â  Â  Â  Â  background-color: #0077b6; /* Latar belakang biru saat hover */
    Â  Â  Â  Â  Â  Â  color: white;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  .dropdown.open .dropdown-content { /* Gunakan class 'open' yang akan di-toggle di JS */
    Â  Â  Â  Â  Â  Â  display: block;
    Â  Â  Â  Â  }
    Â  Â  Â  Â  
    Â  Â  Â  Â  /* GAYA UNTUK INPUT TANGGAL */
    Â  Â  Â  Â  #controls {
    Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
    Â  Â  Â  Â  Â  Â  padding: 15px;
    Â  Â  Â  Â  Â  Â  border: 2px solid #B8FB3C;
    V Â  Â  Â  Â  Â  border-radius: 8px;
    Â  Â  Â  Â  Â  Â  background-color: #05143a;
    Â  Â  Â  Â  Â  Â  display: flex;
    Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
    Â  Â  Â  Â  Â  Â  justify-content: center;
    Â  Â  Â  Â  Â  Â  align-items: center;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  #controls label {
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    Â  Â  Â  Â  Â  Â  font-weight: bold;
    Â  Â  Â  Â  Â  Â  margin-left: 15px;
    Â  Â  Â  Â  Â  Â  margin-right: 5px;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  #controls input[type="date"] {
    Â  Â  Â  Â  Â  Â  padding: 8px;
    Â  Â  Â  Â  Â  Â  margin-right: 5px;
    Â  Â  Â  Â  Â  Â  background-color: #03045E;
    Â  Â  Â  Â  Â  Â  border: 2px solid #B8FB3C;
    Â  Â  Â  Â  Â  Â  border-radius: 5px;
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    M Â  Â  Â  Â  Â  font-size: 16px;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  /* GAYA UNTUK LOADER */
    Â  Â  Â  Â  #loader {
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    Â  Â  Â  Â  Â  Â  margin-left: 10px;
    Â  Â  Â  Â  Â  Â  display: none; /* Default tersembunyi */
    Â  Â  Â  Â  }

    Â  Â  Â  Â  /* ==================== GAYA TABEL DATA ==================== */
    Â  Â  Â  Â  #table-container {
    Â  Â  Â  Â  Â  Â  margin-top: 20px;
    Â  Â  Â  Â  Â  Â  font-family: sans-serif;
    Â  Â  Â  Â  Â  _ overflow-x: auto;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  #table-container table {
    Â  Â  Â  Â  Â  Â  width: 100%;
    Â  Â  Â  Â  Â  Â  min-width: 800px;
    Â  s Â  Â  Â  Â  border-collapse: collapse;
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    Â  Â  Â  Â  Â  Â  background-color: #03045E;
    Â  Â  Â  Â  Â  Â  border: 2px solid #B8FB3C;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  #table-container th, #table-container td {
    Â  Â  Â  Â  Â  Â  border: 1px solid #B8FB3C;
    Â  Â  Â  Â  Â  Â  padding: 8px 12px;
    Â  Â  Â  Â  Â  Â  text-align: left;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  #table-container th {
    Â  Â  Â  Â  Â  Â  background-color: #03045E; /* Warna header sama dengan background */
    Â  Â  Â  Â  Â  Â  color: #B8FB3C;
    Â  Â  Â  Â  Â  Â  font-weight: bold;
    Â  Â  Â  Â  Â  Â  text-transform: uppercase;
    Â  Â  Â  Â  Â  Â  font-size: 14px;
    Â  Â  Â  Â  }

    Â  Â  Â  Â  #table-container tr:nth-child(even) {
    Â  Â  Â  Â  Â  Â  background-color: #05143a;
    Â  Â  Â  Â  }
            /* Style untuk kontainer chart */
            .chart-container {
              width: 80%;
              margin: 20px auto;
              border: 1px solid #ccc;
              padding: 10px;
              box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            }
    Â  Â  </style>
</head>
<body>
  <button class="back-button" onclick="window.top.location.href = '<?= getScriptURL() ?>'">
    &larr; Kembali ke Beranda
  </button>
  
  <h1>Halaman Dashboard ðŸ“ˆ</h1>
  <p>Di sinilah konten visual dan ringkasan data akan ditampilkan.</p>
  <div id="forwardPowerChart" class="chart-container"></div>
  <div id="reflectedPowerChart" class="chart-container"></div>
  <script>
      // Fungsi untuk mengubah string "dd/MM/yyyy" menjadi objek Date
      function parseDateString(dateString) {
        if (!dateString) return null;
        const parts = dateString.split('/'); // dd/MM/yyyy
        // Perhatikan bahwa bulan di JavaScript adalah 0-indexed (Januari=0, Desember=11)
        return new Date(parts[2], parts[1] - 1, parts[0]); // year, month (0-indexed), day
      }
  
      // Fungsi untuk mendapatkan data dan menggambar chart
      function fetchAndDrawCharts() {
        // --- Placeholder Filter (Ganti dengan input dari pengguna jika ada) ---
        const today = new Date();
        const lastWeek = new Date(today);
        lastWeek.setDate(today.getDate() - 7);
        
        // Format YYYY-MM-DD
        const formatDate = (date) => date.toISOString().split('T')[0];
  
        // Menggunakan rentang tanggal 7 hari terakhir sebagai default
        const startDate = formatDate(lastWeek);
        const endDate = formatDate(today);
        const locationFilter = "ALL";
        const employeeFilter = "ALL";
        // --------------------------------------------------------------------
  
        // Panggil fungsi Apps Script untuk mendapatkan data chart
        google.script.run
          .withSuccessHandler(drawCharts)
          .withFailureHandler(onFailure)
          .getPowerChartData(startDate, endDate, locationFilter, employeeFilter);
      }
  
      function onFailure(error) {
        console.error("Gagal mengambil data chart: " + error);
        document.getElementById('forwardPowerChart').innerHTML = 'Gagal memuat data Forward Power: ' + error;
        document.getElementById('reflectedPowerChart').innerHTML = 'Gagal memuat data Reflected Power: ' + error;
      }
  
      // Fungsi untuk menggambar kedua chart
      function drawCharts(chartData) {
        if (!chartData || chartData.length === 0) {
          document.getElementById('forwardPowerChart').innerHTML = 'Tidak ada data Forward Power untuk ditampilkan.';
          document.getElementById('reflectedPowerChart').innerHTML = 'Tidak ada data Reflected Power untuk ditampilkan.';
          return;
        }
        
        // Load Google Visualization API
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(() => {
          
          // 1. Siapkan data untuk Google Charts
          const dataTable = new google.visualization.DataTable();
          dataTable.addColumn('date', 'Tanggal');
          dataTable.addColumn('number', 'Forward Power');
          dataTable.addColumn('number', 'Reflected Power');
  
          chartData.forEach(row => {
            const date = parseDateString(row.Date);
            if (date) {
              dataTable.addRow([date, row.ForwardPower, row.ReflectedPower]);
            }
          });
  
          // 2. Gambar Chart 1: Forward Power
          const forwardPowerData = new google.visualization.DataView(dataTable);
          forwardPowerData.setColumns([
            0, // Tanggal (Date)
            1  // Forward Power (Number)
          ]);
  
          const forwardPowerOptions = {
            title: 'Line Chart: Forward Power (vs. Tanggal)',
            curveType: 'function',
            legend: { position: 'bottom' },
            hAxis: { title: 'Tanggal', format: 'dd MMM' },
            vAxis: { title: 'Forward Power' },
            series: { 0: { color: '#4285F4' } } // Warna biru Google
          };
  
          const forwardPowerChart = new google.visualization.LineChart(document.getElementById('forwardPowerChart'));
          forwardPowerChart.draw(forwardPowerData, forwardPowerOptions);
  
          // 3. Gambar Chart 2: Reflected Power
          const reflectedPowerData = new google.visualization.DataView(dataTable);
          reflectedPowerData.setColumns([
            0, // Tanggal (Date)
            2  // Reflected Power (Number)
          ]);
  
          const reflectedPowerOptions = {
            title: 'Line Chart: Reflected Power (vs. Tanggal)',
            curveType: 'function',
            legend: { position: 'bottom' },
            hAxis: { title: 'Tanggal', format: 'dd MMM' },
            vAxis: { title: 'Reflected Power' },
            series: { 0: { color: '#DB4437' } } // Warna merah Google
          };
  
          const reflectedPowerChart = new google.visualization.LineChart(document.getElementById('reflectedPowerChart'));
          reflectedPowerChart.draw(reflectedPowerData, reflectedPowerOptions);
        });
      }
  
      // Panggil fungsi saat halaman selesai dimuat
      google.charts.setOnLoadCallback(fetchAndDrawCharts);
    
    </script>
  </body>
</html>
