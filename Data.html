<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    /* CSS BARU ANDA */
    .font1 {
        font-family: sans-serif;
        font-size: 50px;
        font-weight: bold;
        color: #B8FB3C;
    }
    .fontkecil {
        font-size: 20px;
    }

    /* ----------------------Tombol-tombol--------------------- */
    .shape-tombol-aksi {
        background-color: #03045E; 
        border: 2px solid #B8FB3C; 
        border-radius: 5px; 
        color: #B8FB3C; 
        padding: 10px 20px;
        font-size: 16px; 
        cursor: pointer;
        display: inline-block; 
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .shape-tombol-aksi:hover {
        background-color: #B8FB3C; 
        color: #03045E;           
        box-shadow: 0 0 10px #B8FB3C; 
    }
    
    .shape-tombol-aksi.selected {
        background-color: #B8FB3C; 
        color: #03045E;
    }


    /* STRUKTUR DROPDOWN */
    .dropdown {
      position: relative;
      display: inline-block; 
      margin-right: 10px;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 200px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
    }

    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      white-space: nowrap;
    }

    .dropdown-content a:hover {
      background-color: #f1f1f1
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    .dropdown:hover .shape-tombol-aksi {
      background-color: #B8FB3C; 
      color: #03045E; 
      box-shadow: 0 0 10px #B8FB3C; 
    }
    
    /* STRUKTUR FILTER TANGGAL BARU */
    #dateFilterContainer {
        display: inline-block;
        margin-left: 20px;
        padding: 10px;
        
        /* Latar belakang biru gelap dan border neon */
        background-color: #03045E; 
        border: 2px solid #B8FB3C; 
        border-radius: 5px;
    }

    /* Style untuk input tanggal agar serasi dengan tema #03045E dan #B8FB3C */
    #dateFilterContainer input[type="date"] {
        padding: 8px;
        margin-right: 5px;
        
        /* MODIFIKASI FILL SHAPE */
        background-color: #03045E; /* Warna latar belakang biru gelap */
        
        /* MODIFIKASI BORDER */
        border: 2px solid #B8FB3C; /* Border 2px, solid, warna hijau neon */
        border-radius: 5px; /* Sesuaikan radius dengan tombol */
        
        /* MODIFIKASI WARNA TEKS */
        color: #B8FB3C; /* Warna teks hijau neon */
        
        font-size: 16px;
    }
    #dateFilterContainer label {
        color: #B8FB3C; /* Teks label menjadi hijau neon */
        font-weight: bold;
        margin-right: 5px; /* Tambahkan sedikit jarak */
    }
    
  </style>
</head>

<body>
  
  <div class="dropdown" id="locationDropdown">
    <button class="shape-tombol-aksi" id="locationButton">Lokasi Transmisi</button>
    <div id="locationList" class="dropdown-content shape-tombol-aksi">
      <a href="#">Memuat lokasi...</a>
    </div>
  </div>

  <div class="dropdown" id="employeeDropdown">
    <button class="shape-tombol-aksi" id="employeeButton">Nama Pegawai</button>
    <div id="employeeList" class="dropdown-content shape-tombol-aksi">
      <a href="#">Pilih Lokasi Transmisi terlebih dahulu</a>
    </div>
  </div>
  
  <div id="dateFilterContainer">
      <label for="startDate">Dari Tanggal:</label>
      <input type="date" id="startDate">
      
      <label for="endDate">Sampai Tanggal:</label>
      <input type="date" id="endDate">
      
      <button class="shape-tombol-aksi" id="applyFilterButton" onclick="applyDateFilter()">
          Terapkan Filter Tanggal
      </button>
  </div>

  <script>
    
    const locationButton = document.getElementById('locationButton');
    const employeeButton = document.getElementById('employeeButton');
    // Variabel untuk menyimpan pilihan saat ini
    let selectedLocation = null;
    let selectedEmployee = null;

    // =================================================================
    // LOGIKA CLIENT-SIDE UMUM
    // =================================================================
    
    // Fungsi untuk memicu filter data keseluruhan
    function runCombinedFilter() {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        
        // Cek apakah data Lokasi Transmisi sudah dipilih
        if (!selectedLocation) {
            alert("Harap pilih Lokasi Transmisi terlebih dahulu!");
            return;
        }

        // Placeholder: Lakukan aksi filter ke Apps Script di sini
        // Selanjutnya: Panggil fungsi server untuk mendapatkan data yang sudah difilter
        console.log("Menerapkan Filter Gabungan:");
        console.log("Lokasi:", selectedLocation);
        console.log("Pegawai:", selectedEmployee);
        console.log("Rentang Tanggal:", startDate, "hingga", endDate);

        // Contoh: google.script.run.getFilteredReport(selectedLocation, selectedEmployee, startDate, endDate);
        alert(`Filter Gabungan diterapkan:\nLokasi: ${selectedLocation}\nPegawai: ${selectedEmployee || 'Semua'}\nTanggal: ${startDate || 'N/A'} - ${endDate || 'N/A'}`);
    }

    // Fungsi khusus yang dipanggil saat tombol "Terapkan Filter Tanggal" diklik
    function applyDateFilter() {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        
        if (!startDate || !endDate) {
            alert("Harap pilih Tanggal Mulai dan Tanggal Akhir.");
            return;
        }

        if (new Date(startDate) > new Date(endDate)) {
            alert("Tanggal Mulai tidak boleh setelah Tanggal Akhir.");
            return;
        }
        
        // Panggil filter gabungan
        runCombinedFilter();
    }


    // =================================================================
    // LOGIKA DROPDOWN (sedikit modifikasi untuk menyimpan pilihan)
    // =================================================================

    function populateLocationDropdown(locations) {
      const dropdownContent = document.getElementById('locationList');
      dropdownContent.innerHTML = '';
      
      locations.forEach(location => {
        const a = document.createElement('a');
        a.textContent = location; 
        a.href = "#"; 
        
        a.addEventListener('click', (event) => {
            event.preventDefault();
            selectedLocation = event.target.textContent; // Simpan pilihan lokasi
            selectedEmployee = null; // Reset pilihan pegawai
            
            locationButton.textContent = selectedLocation;
            locationButton.classList.add('selected');
            
            loadEmployees(selectedLocation);
            // runCombinedFilter(); // Opsi: Terapkan filter otomatis setelah lokasi dipilih
        });
        
        dropdownContent.appendChild(a);
      });
    }

    function loadEmployees(loc) {
        const employeeList = document.getElementById('employeeList');
        employeeList.innerHTML = '<a href="#">Memuat pegawai di ' + loc + '...</a>';
        
        employeeButton.textContent = "Nama Pegawai";
        employeeButton.classList.remove('selected');

        google.script.run
            .withSuccessHandler(populateEmployeeDropdown) 
            .withFailureHandler(onDataError)              
            .getFilteredEmployees(loc);
    }
    
    function populateEmployeeDropdown(employees) {
        const employeeList = document.getElementById('employeeList');
        employeeList.innerHTML = ''; 

        if (employees.length === 0 || (employees.length === 1 && employees[0].includes("Error"))) {
             employeeList.innerHTML = '<a href="#">Tidak ada pegawai ditemukan.</a>';
             return;
        }

        employees.forEach(employee => {
            const a = document.createElement('a');
            a.textContent = employee; 
            a.href = "#" + encodeURIComponent(employee);
            
            a.addEventListener('click', (event) => {
                event.preventDefault();
                selectedEmployee = event.target.textContent; // Simpan pilihan pegawai
                
                employeeButton.textContent = selectedEmployee;
                employeeButton.classList.add('selected');
                
                // runCombinedFilter(); // Opsi: Terapkan filter otomatis setelah pegawai dipilih
            });
            
            employeeList.appendChild(a);
        });
    }

    function onDataError(error) {
        const errorMessage = 'Gagal: ' + (error.message || error.toString());
        document.getElementById('locationList').innerHTML = '<a href="#">' + errorMessage + '</a>';
        document.getElementById('employeeList').innerHTML = '<a href="#">' + errorMessage + '</a>';
    }

    // INISIALISASI
    google.script.run
        .withSuccessHandler(populateLocationDropdown)
        .withFailureHandler(onDataError)
        .getUniqueLocations();
        
  </script>

</body>
</html>